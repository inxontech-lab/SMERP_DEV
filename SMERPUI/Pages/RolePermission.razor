@page "/role-permissions"

<PageTitle>Role Permissions</PageTitle>

<RadzenCard class="role-permission-page">
    <RadzenStack Gap="1rem">
        <RadzenText TextStyle="TextStyle.H4">Role Permission Mapping</RadzenText>

        <RadzenRow>
            <RadzenColumn Size="12" SizeMD="6">
                <RadzenLabel Text="Role" Component="RoleSelect" />
                <RadzenDropDown id="RoleSelect"
                                Data="@Roles"
                                TextProperty="Name"
                                ValueProperty="Id"
                                @bind-Value="SelectedRoleId"
                                Change="@OnRoleChanged"
                                Placeholder="Select role"
                                Style="width: 100%;"
                                Disabled="@IsLoading" />
            </RadzenColumn>
        </RadzenRow>

        @if (IsLoading)
        {
            <RadzenProgressBarCircular Mode="ProgressBarMode.Indeterminate" />
        }
        else if (SelectedRoleId is null)
        {
            <RadzenAlert AlertStyle="AlertStyle.Info" Variant="Variant.Flat">Select a role to manage permissions.</RadzenAlert>
        }
        else if (!Permissions.Any())
        {
            <RadzenAlert AlertStyle="AlertStyle.Warning" Variant="Variant.Flat">No permissions were found.</RadzenAlert>
        }
        else
        {
            <RadzenDataList Data="@Permissions" TItem="Permission" WrapItems="false">
                <Template Context="permission">
                    <div class="permission-item">
                        <RadzenCheckBox TValue="bool"
                                        Value="@IsPermissionAssigned(permission.Id)"
                                        Change="@(value => OnPermissionToggleAsync(permission.Id, (bool)value))"
                                        Disabled="@IsUpdating.Contains(permission.Id)" />
                        <div class="permission-content">
                            <div class="permission-title">@permission.Name</div>
                            <div class="permission-subtitle">@permission.Code (@(permission.Module ?? "General"))</div>
                        </div>
                    </div>
                </Template>
            </RadzenDataList>
        }
    </RadzenStack>
</RadzenCard>
