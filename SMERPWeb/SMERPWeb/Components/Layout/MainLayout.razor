@using SMERPWeb.Services.Auth
ï»¿@inherits LayoutComponentBase

<HeadContent>
    <link href="css/app.css" rel="stylesheet" />
</HeadContent>


@* 
<div class="page">
    <div class="sidebar">
        <NavMenu />
    </div>

    <main>
        <div class="top-row px-4">
            <a href="https://learn.microsoft.com/aspnet/core/" target="_blank">About</a>
        </div>

        <article class="content px-4">
            @Body
        </article>
    </main>
</div>

<div id="blazor-error-ui">
    An unhandled error has occurred.
    <a href="" class="reload">Reload</a>
    <a class="dismiss">ðŸ—™</a>
</div>
 *@


<RadzenComponents @rendermode="RenderMode.InteractiveServer" />
@* <RadzenDialog @rendermode="RenderMode.InteractiveServer" />
<RadzenNotification @rendermode="RenderMode.InteractiveServer" /> *@

@* <RadzenTooltip @rendermode="RenderMode.InteractiveServer" />
<RadzenContextMenu @rendermode="RenderMode.InteractiveServer" />  193e91*@
<RadzenLayout>
    <RadzenHeader>
        <RadzenRow JustifyContent="JustifyContent.Start" AlignItems="AlignItems.Center" Gap="0">
            <RadzenColumn Size="10">
                <RadzenStack AlignItems="AlignItems.Start" Orientation="Orientation.Horizontal">
                    <RadzenSidebarToggle Click="@SidebarToggleClick"></RadzenSidebarToggle>
                    @* <h1>Easy Transport</h1> *@
                </RadzenStack>
            </RadzenColumn>
            <RadzenColumn Size="2">
                <RadzenStack AlignItems="AlignItems.Center" Orientation="Orientation.Horizontal" JustifyContent="JustifyContent.End" Gap="0.5rem">
                    @if (!string.IsNullOrWhiteSpace(UserBadgeText))
                    {
                        <RadzenText Text="@UserBadgeText" Style="color:#1f2937; font-size:0.9rem;" />
                    }
                    <RadzenProfileMenu Click="@ProfileMenuClick">
                        <ChildContent>
                            <RadzenProfileMenuItem Text="Logout" Value="Logout" Icon="power_settings_new" />
                        </ChildContent>
                        <Template>
                        </Template>
                    </RadzenProfileMenu>
                </RadzenStack>
            </RadzenColumn>
        </RadzenRow>
    </RadzenHeader>
    <RadzenBody>
        @Body
    </RadzenBody>


    @* #F9F9F9 #FFFFFF  #f3f6f9 color: var(--rz-sidebar-color);*@
    @* <RadzenImage Path="images/PHC_1.png" style="width: 200px; height: 180px;background-color:#f3f6f9"></RadzenImage> *@
    <RadzenSidebar Expanded="@sidebarExpanded">
        <RadzenStack AlignItems="Radzen.AlignItems.Center" class="rz-py-4 rz-py-lg-6">
            <RadzenText Text="App Name" TextStyle="Radzen.Blazor.TextStyle.Subtitle1" Style="color:#F9F9F9" />
        </RadzenStack>
        <RadzenPanelMenu Multiple="true">
            <RadzenPanelMenuItem Text="Dashboard" Path="/Dashboard" Icon="dashboard" IconColor="@Colors.Info" />
            <RadzenPanelMenuItem Text="Master Forms" Icon="label" IconColor="@Colors.Primary">
                <RadzenPanelMenuItem Text="Tenant" Path="/Tenant" Icon="business" IconColor="@Colors.Primary" />
                <RadzenPanelMenuItem Text="Tenant Setting" Path="/TenantSetting" Icon="settings" IconColor="@Colors.Info" />
                <RadzenPanelMenuItem Text="Branch" Path="/Branch" Icon="account_tree" IconColor="@Colors.Warning" />
                <RadzenPanelMenuItem Text="Role" Path="/Role" Icon="badge" IconColor="@Colors.Secondary" />
                <RadzenPanelMenuItem Text="Role Permission" Path="/RolePermission" Icon="lock_open" IconColor="@Colors.Warning" />
                <RadzenPanelMenuItem Text="POS Terminal" Path="/PosTerminal" Icon="point_of_sale" IconColor="@Colors.Success" />
                <RadzenPanelMenuItem Text="User" Path="/User" Icon="account_circle" IconColor="@Colors.Success" />
            </RadzenPanelMenuItem>
            <RadzenPanelMenuItem Text="Transactions" Icon="label" IconColor="@Colors.Primary">
            </RadzenPanelMenuItem>
            <RadzenPanelMenuItem Text="Accounts" Icon="label" IconColor="@Colors.Primary">
            </RadzenPanelMenuItem>
            <RadzenPanelMenuItem Text="Reports" Icon="assignment" IconColor="@Colors.Primary">
            </RadzenPanelMenuItem>
        </RadzenPanelMenu>
        <RadzenStack AlignItems="Radzen.AlignItems.Center" Gap="0" class="rz-py-4 rz-py-lg-6" Style="padding: var(--rz-panel-menu-item-padding);">
            <RadzenText Text="Application Name v1.0.0" TextStyle="Radzen.Blazor.TextStyle.Caption" style="color: var(--rz-text-disabled-color);" TagName="Radzen.Blazor.TagName.P" TextAlign="Radzen.TextAlign.Center" />
            <RadzenText Text="Copyright â’¸ 2025" TextStyle="Radzen.Blazor.TextStyle.Caption" class="rz-mb-0" style="color: var(--rz-text-disabled-color);" TagName="Radzen.Blazor.TagName.P" TextAlign="Radzen.TextAlign.Center" />
        </RadzenStack>
    </RadzenSidebar>
</RadzenLayout>
@code {
    [Inject]
    protected IJSRuntime JSRuntime { get; set; }

    [Inject]
    protected IUserSessionService UserSessionService { get; set; } = default!;
    [Inject]
    protected NavigationManager NavigationManager { get; set; }
    [Inject]
    protected DialogService DialogService { get; set; }
    [Inject]
    protected TooltipService TooltipService { get; set; }
    [Inject]
    protected ContextMenuService ContextMenuService { get; set; }
    [Inject]
    protected NotificationService NotificationService { get; set; }
    private bool sidebarExpanded = true;
    private string? UserBadgeText { get; set; }

    protected override async Task OnInitializedAsync()
    {
        var session = await UserSessionService.GetSessionAsync();
        if (session is null)
        {
            NavigationManager.NavigateTo("/", true);
            return;
        }

        var displayName = string.IsNullOrWhiteSpace(session.DisplayName) ? session.Username : session.DisplayName;
        UserBadgeText = string.IsNullOrWhiteSpace(session.TenantName)
            ? displayName
            : $"{displayName} ({session.TenantName})";
    }

    void SidebarToggleClick()
    {
        sidebarExpanded = !sidebarExpanded;
    }

    protected async Task ProfileMenuClick(RadzenProfileMenuItem args)
    {
        if (args.Value?.ToString() == "Logout")
        {
            await UserSessionService.ClearSessionAsync();
            NavigationManager.NavigateTo("/", true);
        }
    }

    void NavigateToPage(string pageUrl)
    {
        NavigationManager.NavigateTo(pageUrl, true);
    }
}
